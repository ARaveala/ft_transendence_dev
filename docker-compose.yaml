version: '3.8'

services:
  php:
    build: ./dummy
    container_name: dummy-server
    restart: always
    expose:
      - "8080"
    networks:
      - compost

  waf:
    build: ./nginx-waf
    container_name: modsecurity
    restart: always
    depends_on:
      - php
    environment:
      - WAF_MODE: "DetectionOnly" # change to On after testing
      - MODSECURITY: "https://github.com/owasp-modsecurity/ModSecurity"
      - CONNECTOR: "https://github.com/owasp-modsecurity/ModSecurity-nginx"
      - CRS: "https://github.com/coreruleset/coreruleset"
    volumes:
      - ./waf-data:/waf/src:rw #caches git repos (lib + connector)
      - ./waf-conf:/etc/nginx/modsec:rw # modsec + CRD configs
      - ./waf-logs:/var/log/modsecurity:rw
      - ./nginx/conf/default.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
    - "8080:8080"
    networks:
      - compost 

networks:
  compost:
    driver: bridge

# the volumes part is not needed? unless you need to specify an absolute path, etc
# having the volumes specified in the service block is the short-form, otherwise it would have been long form

